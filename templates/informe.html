<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe Pericial - {{ informe.numero_expediente }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/informe.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body class="informe-body">
    <!-- Barra de acciones -->
    <div class="informe-actions no-print">
        <div class="container">
            <a href="/" class="btn btn-secondary btn-small">Volver al inicio</a>
            <div class="action-buttons">
                <a href="/mapa-conceptual/{{ informe_id }}" class="btn btn-accent btn-small">Ver Mapa Conceptual</a>
                <button onclick="window.print()" class="btn btn-primary btn-small">Imprimir / PDF</button>
                <button onclick="descargarWord()" class="btn btn-secondary btn-small">Exportar Word</button>
            </div>
        </div>
    </div>

    <!-- Contenedor del informe -->
    <div class="informe-container">
        <!-- 1. PORTADA -->
        <section class="informe-portada page-break">
            <div class="portada-content">
                <div class="portada-logo">
                    <svg class="logo-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="50" r="45" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M30 50 L45 35 L70 60" stroke="currentColor" stroke-width="3" fill="none"/>
                        <circle cx="50" cy="50" r="8" fill="currentColor"/>
                    </svg>
                </div>
                
                <h1 class="portada-titulo">INFORME PERICIAL</h1>
                
                <div class="portada-info">
                    <div class="info-item">
                        <strong>Perito:</strong>
                        <p>{{ informe.perito.nombre }}</p>
                    </div>
                    
                    <div class="info-item">
                        <strong>Especialidad:</strong>
                        <p>{{ informe.perito.especialidad }}</p>
                    </div>
                    
                    <div class="info-item">
                        <strong>Nº Colegiado:</strong>
                        <p>{{ informe.perito.num_colegiado }}</p>
                    </div>
                    
                    <div class="info-item">
                        <strong>Solicitante:</strong>
                        <p>{{ informe.solicitante.nombre }}</p>
                    </div>
                    
                    <div class="info-item">
                        <strong>Fecha de elaboración:</strong>
                        <p>{{ informe.fecha_elaboracion }}</p>
                    </div>
                    
                    <div class="info-item">
                        <strong>Nº Expediente:</strong>
                        <p>{{ informe.numero_expediente }}</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. ÍNDICE -->
        <section class="informe-seccion page-break">
            <h2 class="seccion-titulo">ÍNDICE</h2>
            <div class="indice">
                <div class="indice-item">
                    <span class="indice-titulo">1. Portada</span>
                    <span class="indice-puntos"></span>
                    <span class="indice-pagina">1</span>
                </div>
                <div class="indice-item">
                    <span class="indice-titulo">2. Índice</span>
                    <span class="indice-puntos"></span>
                    <span class="indice-pagina">2</span>
                </div>
                <div class="indice-item">
                    <span class="indice-titulo">3. Datos del perito</span>
                    <span class="indice-puntos"></span>
                    <span class="indice-pagina">3</span>
                </div>
                <div class="indice-item">
                    <span class="indice-titulo">4. Datos del solicitante</span>
                    <span class="indice-puntos"></span>
                    <span class="indice-pagina">4</span>
                </div>
                <div class="indice-item">
                    <span class="indice-titulo">5. Descripción del suceso / Objeto del informe</span>
                    <span class="indice-puntos"></span>
                    <span class="indice-pagina">5</span>
                </div>
                <div class="indice-item">
                    <span class="indice-titulo">6. Antecedentes</span>
                    <span class="indice-puntos"></span>
                    <span class="indice-pagina">6</span>
                </div>
                <div class="indice-item">
                    <span class="indice-titulo">7. Metodología</span>
                    <span class="indice-puntos"></span>
                    <span class="indice-pagina">7</span>
                </div>
                <div class="indice-item">
                    <span class="indice-titulo">8. Desarrollo del análisis</span>
                    <span class="indice-puntos"></span>
                    <span class="indice-pagina">8</span>
                </div>
                <div class="indice-item">
                    <span class="indice-titulo">9. Conclusiones</span>
                    <span class="indice-puntos"></span>
                    <span class="indice-pagina">12</span>
                </div>
                <div class="indice-item">
                    <span class="indice-titulo">10. Documentación anexa</span>
                    <span class="indice-puntos"></span>
                    <span class="indice-pagina">14</span>
                </div>
                <div class="indice-item">
                    <span class="indice-titulo">11. Fecha y firma</span>
                    <span class="indice-puntos"></span>
                    <span class="indice-pagina">15</span>
                </div>
            </div>
        </section>

        <!-- 3. DATOS DEL PERITO -->
        <section class="informe-seccion page-break">
            <h2 class="seccion-titulo">3. DATOS DEL PERITO</h2>
            <div class="datos-tabla">
                <div class="dato-row">
                    <strong>Nombre completo:</strong>
                    <span>{{ informe.perito.nombre }}</span>
                </div>
                <div class="dato-row">
                    <strong>Documento de identidad:</strong>
                    <span>{{ informe.perito.dni }}</span>
                </div>
                <div class="dato-row">
                    <strong>Dirección profesional:</strong>
                    <span>{{ informe.perito.direccion }}</span>
                </div>
                <div class="dato-row">
                    <strong>Teléfono:</strong>
                    <span>{{ informe.perito.telefono }}</span>
                </div>
                <div class="dato-row">
                    <strong>Correo electrónico:</strong>
                    <span>{{ informe.perito.email }}</span>
                </div>
                <div class="dato-row">
                    <strong>Título profesional y especialidad:</strong>
                    <span>{{ informe.perito.titulo }} - {{ informe.perito.especialidad }}</span>
                </div>
                <div class="dato-row">
                    <strong>Nº de colegiado:</strong>
                    <span>{{ informe.perito.num_colegiado }}</span>
                </div>
            </div>
            
            <div class="subseccion">
                <h3>Experiencia profesional relevante</h3>
                <p>{{ informe.perito.experiencia }}</p>
            </div>
            
            <div class="juramento">
                <h3>Juramento del cargo</h3>
                <p><em>{{ informe.perito.juramento }}</em></p>
            </div>
        </section>

        <!-- 4. DATOS DEL SOLICITANTE -->
        <section class="informe-seccion">
            <h2 class="seccion-titulo">4. DATOS DEL SOLICITANTE</h2>
            <div class="datos-tabla">
                <div class="dato-row">
                    <strong>Nombre completo / Razón social:</strong>
                    <span>{{ informe.solicitante.nombre }}</span>
                </div>
                <div class="dato-row">
                    <strong>Representación:</strong>
                    <span>{{ informe.solicitante.representacion }}</span>
                </div>
                <div class="dato-row">
                    <strong>Domicilio:</strong>
                    <span>{{ informe.solicitante.domicilio }}</span>
                </div>
                <div class="dato-row">
                    <strong>Tipo de encargo:</strong>
                    <span>{{ informe.solicitante.tipo_encargo }}</span>
                </div>
            </div>
        </section>

        <!-- 5. DESCRIPCIÓN DEL SUCESO / OBJETO DEL INFORME -->
        <section class="informe-seccion page-break">
            <h2 class="seccion-titulo">5. DESCRIPCIÓN DEL SUCESO / OBJETO DEL INFORME</h2>
            
            <div class="subseccion">
                <h3>Conjetura inicial</h3>
                <p class="conjetura-texto">{{ informe.conjetura }}</p>
            </div>
            
            <div class="subseccion">
                <h3>Descripción del hecho</h3>
                <p>{{ informe.descripcion.hecho }}</p>
            </div>
            
            <div class="subseccion">
                <h3>Fecha y lugar del suceso</h3>
                <p>{{ informe.descripcion.fecha_lugar }}</p>
            </div>
            
            <div class="subseccion">
                <h3>Alcance del encargo pericial</h3>
                <p>{{ informe.descripcion.alcance }}</p>
            </div>
        </section>

        <!-- 6. ANTECEDENTES -->
        <section class="informe-seccion">
            <h2 class="seccion-titulo">6. ANTECEDENTES</h2>
            
            <div class="subseccion">
                <h3>Hechos conocidos previos</h3>
                <p>{{ informe.antecedentes.hechos_previos }}</p>
            </div>
            
            <div class="subseccion">
                <h3>Documentación entregada</h3>
                <ul>
                    {% for doc in informe.antecedentes.documentacion %}
                    <li>{{ doc }}</li>
                    {% endfor %}
                </ul>
            </div>
            
            <div class="subseccion">
                <h3>Normativa aplicable</h3>
                <p>{{ informe.antecedentes.normativa }}</p>
            </div>
        </section>

        <!-- 7. METODOLOGÍA -->
        <section class="informe-seccion page-break">
            <h2 class="seccion-titulo">7. METODOLOGÍA</h2>
            
            <div class="metodologia-box">
                <h3>Método Formal Causal</h3>
                <p>El presente informe ha sido elaborado siguiendo el <strong>Método Formal Causal</strong>, un enfoque estructurado que garantiza la fundamentación y motivación de las conclusiones mediante el análisis sistemático de tres preguntas fundamentales.</p>
            </div>
            
            <div class="subseccion">
                <h3>Técnicas y procedimientos utilizados</h3>
                <ul>
                    {% for tecnica in informe.metodologia.tecnicas %}
                    <li>{{ tecnica }}</li>
                    {% endfor %}
                </ul>
            </div>
            
            <div class="subseccion">
                <h3>Criterios de valoración</h3>
                <p>{{ informe.metodologia.criterios }}</p>
            </div>
            
            <div class="subseccion">
                <h3>Normas técnicas o legales aplicadas</h3>
                <p>{{ informe.metodologia.normas }}</p>
            </div>
            
            <div class="subseccion">
                <h3>Herramientas empleadas</h3>
                <ul>
                    {% for herramienta in informe.metodologia.herramientas %}
                    <li>{{ herramienta }}</li>
                    {% endfor %}
                </ul>
            </div>
        </section>

        <!-- 8. DESARROLLO DEL ANÁLISIS (Método Formal Causal) -->
        <section class="informe-seccion page-break">
            <h2 class="seccion-titulo">8. DESARROLLO DEL ANÁLISIS</h2>
            
            <div class="metodologia-formal-causal">
                <!-- Fase 1: ¿POR QUÉ? -->
                <div class="fase-analisis">
                    <h3 class="fase-titulo">8.1. ¿POR QUÉ? - Análisis de Motivaciones</h3>
                    
                    <div class="motivacion-tipo">
                        <h4>8.1.1. Motivaciones Preceptivas</h4>
                        <p class="motivacion-desc"><em>Surgen del propio enunciado del problema</em></p>
                        <div class="motivacion-contenido">
                            {% for motivacion in informe.analisis.por_que.preceptivas %}
                            <div class="motivacion-item">
                                <h5>{{ motivacion.titulo }}</h5>
                                <p>{{ motivacion.contenido }}</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="motivacion-tipo">
                        <h4>8.1.2. Motivaciones Técnicas</h4>
                        <p class="motivacion-desc"><em>Implícitas en el problema (leyes, normas, regulaciones)</em></p>
                        <div class="motivacion-contenido">
                            {% for motivacion in informe.analisis.por_que.tecnicas %}
                            <div class="motivacion-item">
                                <h5>{{ motivacion.titulo }}</h5>
                                <p>{{ motivacion.contenido }}</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="motivacion-tipo">
                        <h4>8.1.3. Motivaciones Facultativas</h4>
                        <p class="motivacion-desc"><em>Motivación profesional del autor</em></p>
                        <div class="motivacion-contenido">
                            {% for motivacion in informe.analisis.por_que.facultativas %}
                            <div class="motivacion-item">
                                <h5>{{ motivacion.titulo }}</h5>
                                <p>{{ motivacion.contenido }}</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="motivacion-tipo">
                        <h4>8.1.4. Motivaciones Progresistas</h4>
                        <p class="motivacion-desc"><em>Aportación al conocimiento actual</em></p>
                        <div class="motivacion-contenido">
                            {% for motivacion in informe.analisis.por_que.progresistas %}
                            <div class="motivacion-item">
                                <h5>{{ motivacion.titulo }}</h5>
                                <p>{{ motivacion.contenido }}</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- Fase 2: ¿PARA QUÉ? -->
                <div class="fase-analisis page-break">
                    <h3 class="fase-titulo">8.2. ¿PARA QUÉ? - Objetivos y Finalidades</h3>
                    
                    <div class="para-que-contenido">
                        <p class="motivacion-desc"><em>Los objetivos están relacionados con las motivaciones identificadas en la fase anterior.</em></p>
                        
                        {% for objetivo in informe.analisis.para_que %}
                        <div class="objetivo-item">
                            <h5>{{ objetivo.titulo }}</h5>
                            <p class="objetivo-tipo"><strong>Tipo:</strong> {{ objetivo.tipo | capitalize }}</p>
                            <p>{{ objetivo.contenido }}</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Fase 3: ¿QUÉ ES? -->
                <div class="fase-analisis">
                    <h3 class="fase-titulo">8.3. ¿QUÉ ES? - Definición y Contextualización</h3>
                    
                    <div class="que-es-contenido">
                        {{ informe.analisis.que_es.contenido }}
                    </div>
                    
                    <div class="subseccion">
                        <h4>Contextualización del problema</h4>
                        <p>{{ informe.analisis.que_es.contexto }}</p>
                    </div>
                </div>
                
                <!-- Inspecciones y Estudios -->
                <div class="fase-analisis page-break">
                    <h3 class="fase-titulo">8.4. Inspecciones y Estudios Realizados</h3>
                    
                    <div class="subseccion">
                        <h4>Descripción de inspecciones</h4>
                        <p>{{ informe.analisis.inspecciones }}</p>
                    </div>
                    
                    <div class="subseccion">
                        <h4>Resultados y cálculos</h4>
                        <div class="resultados-tecnicos">
                            {{ informe.analisis.resultados }}
                        </div>
                    </div>
                    
                    <div class="subseccion">
                        <h4>Evaluación objetiva</h4>
                        <p>{{ informe.analisis.evaluacion }}</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 9. CONCLUSIONES -->
        <section class="informe-seccion page-break">
            <h2 class="seccion-titulo">9. CONCLUSIONES</h2>
            
            <div class="conclusiones-contenido">
                <div class="subseccion">
                    <h3>Respuestas a las cuestiones planteadas</h3>
                    <ol class="conclusiones-lista">
                        {% for conclusion in informe.conclusiones.respuestas %}
                        <li>{{ conclusion }}</li>
                        {% endfor %}
                    </ol>
                </div>
                
                <div class="subseccion">
                    <h3>Opinión técnica del perito</h3>
                    <p class="opinion-tecnica">{{ informe.conclusiones.opinion_tecnica }}</p>
                </div>
                
                {% if informe.conclusiones.recomendaciones %}
                <div class="subseccion">
                    <h3>Recomendaciones</h3>
                    <ul>
                        {% for recomendacion in informe.conclusiones.recomendaciones %}
                        <li>{{ recomendacion }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </section>

        <!-- 10. DOCUMENTACIÓN ANEXA -->
        <section class="informe-seccion page-break">
            <h2 class="seccion-titulo">10. DOCUMENTACIÓN ANEXA</h2>
            
            <div class="anexos-lista">
                {% for anexo in informe.anexos %}
                <div class="anexo-item">
                    <span class="anexo-numero">Anexo {{ loop.index }}:</span>
                    <span class="anexo-descripcion">{{ anexo }}</span>
                </div>
                {% endfor %}
            </div>
            
            <div class="nota-anexos">
                <p><em>La documentación anexa se encuentra adjunta al presente informe y forma parte integrante del mismo.</em></p>
            </div>
        </section>

        <!-- 11. FECHA Y FIRMA -->
        <section class="informe-seccion page-break">
            <h2 class="seccion-titulo">11. FECHA Y FIRMA</h2>
            
            <div class="firma-contenedor">
                <div class="firma-lugar-fecha">
                    <p><strong>Lugar:</strong> {{ informe.firma.lugar }}</p>
                    <p><strong>Fecha:</strong> {{ informe.firma.fecha }}</p>
                </div>
                
                <div class="firma-espacio">
                    <div class="firma-linea"></div>
                    <p class="firma-nombre">{{ informe.perito.nombre }}</p>
                    <p class="firma-titulo">{{ informe.perito.titulo }}</p>
                    <p class="firma-colegiado">Col. Nº {{ informe.perito.num_colegiado }}</p>
                </div>
                
                <div class="firma-sello">
                    <div class="sello-placeholder">
                        <p>Sello profesional</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script src="{{ url_for('static', filename='js/informe.js') }}"></script>
</body>
</html>
